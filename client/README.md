# Voice Assistant Client

音声チャットシステムのクライアントサイド実装です。

## アーキテクチャ

### レイヤー構成
```
client/
├── core/          # コア層 - メインクライアント機能
├── services/      # サービス層 - 音声処理・API通信
├── models/        # モデル層 - データモデル
├── utils/         # ユーティリティ層 - 共通処理
└── main.py        # エントリーポイント
```

### 責務分離
- **コア層**: クライアント統合、設定管理
- **サービス層**: 音声録音・再生、サーバー通信
- **モデル層**: 音声データ、設定データの型定義
- **ユーティリティ層**: 音声処理、バリデーション

## セットアップ

### 1. 依存関係のインストール
```bash
# プロジェクトルートで実行
uv sync
```

### 2. 環境変数の設定（オプション）
プロジェクトルートの`.env`ファイルに以下を設定:
```
SERVER_URL=http://192.168.1.100:8000
```

### 3. 複数PCから接続する場合
デフォルトでは`localhost:8000`に接続しますが、複数のPCから接続する場合は：

1. **サーバー側のIPアドレスを確認**
   ```bash
   # macOS/Linux
   ifconfig | grep inet
   # Windows
   ipconfig
   ```

2. **クライアント側で接続先を指定**
   - 環境変数で設定: `SERVER_URL=http://サーバーIP:8000`
   - 実行時に指定: `uv run python run_client.py http://サーバーIP:8000`

3. **ファイアウォールの設定**
   - サーバー側で8000番ポートを開放してください(macだとデフォルトで解放されておりおそらく不要)

### 4. クライアントの起動
```bash
# プロジェクトルートから実行
uv run python run_client.py

# 別のサーバーに接続する場合
uv run python run_client.py http://192.168.1.100:8000
```

## 使用方法

### 基本的な流れ
1. クライアントを起動すると音声入力待機状態になります
2. 話しかけると自動的に録音が開始されます（VAD機能）
3. 発話が終わると録音が停止し、サーバーに送信されます
4. AI応答が音声で再生されます
5. Ctrl+Cで終了

### 音声検出（VAD）
- 音量閾値を超えると録音開始
- 無音状態が一定時間続くと録音停止
- 自動的に発話の開始・終了を検出

## 設定項目

### 環境変数
| 変数名 | デフォルト値 | 説明 |
|--------|-------------|------|
| `SERVER_URL` | http://localhost:8000 | 接続するサーバーのURL |

### 音声設定
| 項目 | 値 | 説明 |
|------|------|------|
| サンプルレート | 16000Hz | 音声の品質 |
| チャンクサイズ | 1024 | 録音バッファサイズ |
| 音量閾値 | 500 | 音声検出の感度 |
| 無音判定時間 | 1.0秒 | 録音停止までの時間 |

## 機能詳細

### 音声録音
- リアルタイム音声活動検出（VAD）
- 自動録音開始・停止
- ノイズ除去機能

### サーバー通信
- HTTP マルチパートファイル送信
- 接続状態の監視
- エラーハンドリング

### 音声再生
- WAV形式対応
- 一時ファイル管理
- 再生完了通知

## 依存関係

- requests: HTTP クライアント
- pyaudio: 音声入出力
- numpy: 音声データ処理

## トラブルシューティング

### 音声が録音されない
- マイクの接続・設定を確認
- 音量閾値の調整が必要な場合があります

### サーバーに接続できない
- サーバーが起動しているか確認
- ネットワーク接続を確認
- ファイアウォール設定を確認

### 音声が再生されない
- スピーカーの接続・設定を確認
- afplayコマンドが利用可能か確認（macOS）